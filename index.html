<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸš– å«è»Šè¡¨å–®</title>
<style>
body{font-family:Arial,sans-serif;background:#f2f2f2;margin:0;padding:0;}
.container{max-width:500px;margin:40px auto;background:#fff;padding:30px;border-radius:10px;box-shadow:0 0 10px rgba(0,0,0,0.1);}
h2{text-align:center;color:#333;}
label{display:block;margin-top:15px;color:#555;}
input,textarea{width:100%;padding:12px;margin-top:5px;border:1px solid #ccc;border-radius:6px;box-sizing:border-box;font-size:16px;}
textarea{resize:vertical;}
button{width:100%;padding:15px;margin-top:25px;background:#4CAF50;color:white;border:none;border-radius:8px;font-size:18px;cursor:pointer;}
button:hover{background:#45a049;}
.alert{display:none;margin-top:20px;padding:15px;background-color:#4CAF50;color:white;border-radius:6px;text-align:center;}
#loginBtn{background:#1DB954;}
@media(max-width:600px){.container{margin:20px;padding:20px;}}
</style>
</head>
<body>
<div class="container">
<h2>ğŸš– å«è»Šè¡¨å–®</h2>

<!-- ç™»å…¥æŒ‰éˆ• -->
<button id="loginBtn" style="display:none;">ğŸ”‘ ä½¿ç”¨ LINE ç™»å…¥</button>

<!-- è¡¨å–® -->
<form id="taxiForm" style="display:none;">
<label>é›»è©±ï¼ˆå¯å¡«å¯ä¸å¡«ï¼‰</label>
<input type="tel" name="phone" placeholder="è«‹è¼¸å…¥é›»è©±">
<label>ä¸Šè»Šåœ°é»ï¼ˆå¯å¡«å¯ä¸å¡«ï¼‰</label>
<input type="text" name="pickup" placeholder="è«‹è¼¸å…¥ä¸Šè»Šåœ°é»">
<label>ç›®çš„åœ°ï¼ˆå¯å¡«å¯ä¸å¡«ï¼‰</label>
<input type="text" name="destination" placeholder="è«‹è¼¸å…¥ç›®çš„åœ°">
<label>å‚™è¨»ï¼ˆå¯å¡«å¯ä¸å¡«ï¼‰</label>
<textarea name="note" rows="3" placeholder="å¯è¼¸å…¥ç‰¹æ®Šéœ€æ±‚æˆ–å‚™è¨»"></textarea>
<button type="submit">ğŸ“© å«è»Š</button>
</form>

<div class="alert" id="alertBox">âœ… è¨Šæ¯å·²é€åˆ° LINEï¼Œè«‹ç­‰å¾…å¸æ©Ÿè¯çµ¡ï¼</div>
</div>

<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script>
let userId = '';
const form = document.getElementById('taxiForm');
const alertBox = document.getElementById('alertBox');
const loginBtn = document.getElementById('loginBtn');

async function initLIFF() {
    const liffId = "2007979399-ge92zyvv"; // ä½ çš„ LIFF ID
    try {
        await liff.init({ liffId });
        console.log("âœ… LIFF åˆå§‹åŒ–å®Œæˆ");

        if (!liff.isLoggedIn()) {
            console.log("å°šæœªç™»å…¥ â†’ é¡¯ç¤ºç™»å…¥æŒ‰éˆ•");
            loginBtn.style.display = 'block';
        } else {
            console.log("å·²ç™»å…¥ â†’ é¡¯ç¤ºè¡¨å–®");
            const profile = await liff.getProfile();
            userId = profile.userId;
            form.style.display = 'block';
        }
    } catch (err) {
        alert("LIFF åˆå§‹åŒ–å¤±æ•—: " + err);
        console.error(err);
    }
}

// ç¢ºä¿é»æ“Šæ‰è§¸ç™¼ç™»å…¥ï¼ˆLINE in-app å¯ç”¨ï¼‰
loginBtn.addEventListener("click", function(){
    console.log("ğŸ‘‰ æŒ‰ä¸‹ç™»å…¥æŒ‰éˆ•");
    liff.login({ redirectUri: window.location.href });
});

// è¡¨å–®é€å‡º
form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    if(!userId){
        alert('å°šæœªç™»å…¥ LINEï¼Œè«‹å…ˆç™»å…¥');
        return;
    }

    const now = new Date();
    const timeStr = now.getFullYear()+'-'+String(now.getMonth()+1).padStart(2,'0')+'-'+String(now.getDate()).padStart(2,'0')+' '+String(now.getHours()).padStart(2,'0')+':'+String(now.getMinutes()).padStart(2,'0');

    const data = {
        userId: userId,
        phone: form.phone.value || "æœªå¡«",
        pickup: form.pickup.value || "æœªå¡«",
        destination: form.destination.value || "æœªå¡«",
        note: form.note.value || "æœªå¡«",
        time: timeStr
    };

    try{
        const res = await fetch("https://script.google.com/macros/s/AKfycbyBeXOpDLNGqwlVZrTN01EsH5OuYVITx1VI5E2zbi8oOoiZYK7bWBw1M9pQ26hN3HK6/exec", {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify(data)
        });
        const result = await res.text();
        console.log("ä¼ºæœå™¨å›è¦†:", result);
        alertBox.style.display='block';
        setTimeout(()=>{alertBox.style.display='none';form.reset();},2000);
    }catch(err){
        alert("ç™¼é€å¤±æ•—ï¼š"+err);
        console.error(err);
    }
});

initLIFF();
</script>
</body>
</html>